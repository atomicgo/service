<!--



┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│                          IMPORTANT NOTE                           │
│                                                                   │
│               This file is automatically generated                │
│           All manual modifications will be overwritten            │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘



-->

<h1 align="center">AtomicGo | service</h1>

<p align="center">
<img src="https://img.shields.io/endpoint?url=https%3A%2F%2Fatomicgo.dev%2Fapi%2Fshields%2Fservice&style=flat-square" alt="Downloads">

<a href="https://github.com/atomicgo/service/releases">
<img src="https://img.shields.io/github/v/release/atomicgo/service?style=flat-square" alt="Latest Release">
</a>

<a href="https://codecov.io/gh/atomicgo/service" target="_blank">
<img src="https://img.shields.io/github/actions/workflow/status/atomicgo/service/go.yml?style=flat-square" alt="Tests">
</a>

<a href="https://codecov.io/gh/atomicgo/service" target="_blank">
<img src="https://img.shields.io/codecov/c/gh/atomicgo/service?color=magenta&logo=codecov&style=flat-square" alt="Coverage">
</a>

<a href="https://codecov.io/gh/atomicgo/service">
<!-- unittestcount:start --><img src="https://img.shields.io/badge/Unit_Tests-14-magenta?style=flat-square" alt="Unit test count"><!-- unittestcount:end -->
</a>

<a href="https://opensource.org/licenses/MIT" target="_blank">
<img src="https://img.shields.io/badge/License-MIT-yellow.svg?style=flat-square" alt="License: MIT">
</a>
  
<a href="https://goreportcard.com/report/github.com/atomicgo/service" target="_blank">
<img src="https://goreportcard.com/badge/github.com/atomicgo/service?style=flat-square" alt="Go report">
</a>   

</p>

---

<p align="center">
<strong><a href="https://pkg.go.dev/atomicgo.dev/service#section-documentation" target="_blank">Documentation</a></strong>
|
<strong><a href="https://github.com/atomicgo/atomicgo/blob/main/CONTRIBUTING.md" target="_blank">Contributing</a></strong>
|
<strong><a href="https://github.com/atomicgo/atomicgo/blob/main/CODE_OF_CONDUCT.md" target="_blank">Code of Conduct</a></strong>
</p>

---

<p align="center">
  <img src="https://raw.githubusercontent.com/atomicgo/atomicgo/main/assets/header.png" alt="AtomicGo">
</p>

<p align="center">
<table>
<tbody>
</tbody>
</table>
</p>
<h3  align="center"><pre>go get atomicgo.dev/service</pre></h3>
<p align="center">
<table>
<tbody>
</tbody>
</table>
</p>

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# service

```go
import "atomicgo.dev/service"
```

Package service provides a lightweight, production\-ready HTTP service framework for Go applications.

The service framework is designed to be Kubernetes\-ready and follows best practices for highly available microservices. It includes built\-in support for graceful shutdown, Prometheus metrics, structured logging, middleware, and environment\-based configuration.

\#\# Features

\- \*\*HTTP Server\*\*: Configurable HTTP server with timeouts and graceful shutdown \- \*\*Metrics\*\*: Built\-in Prometheus metrics collection with automatic request tracking \- \*\*Logging\*\*: Structured logging with slog integration and context\-aware loggers \- \*\*Middleware\*\*: Extensible middleware system with built\-in recovery and logging \- \*\*Configuration\*\*: Environment\-based configuration with sensible defaults \- \*\*Graceful Shutdown\*\*: Signal handling with configurable shutdown hooks \- \*\*Health Checks\*\*: Built\-in health check endpoints \- \*\*Kubernetes Ready\*\*: Designed for containerized deployments

\#\# Quick Start

\`\`\`go package main

import \(

```
"log/slog"
"net/http"
"os"

"atomicgo.dev/service"
```

\)

```
func main() {
    // Create service with default configuration
    svc := service.New("my-service", nil)

    // Register handlers
    svc.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
        logger := service.GetLogger(r)
        logger.Info("Hello, World!")
        w.Write([]byte("Hello, World!"))
    })

    // Start with graceful shutdown
    if err := svc.StartWithGracefulShutdown(); err != nil {
        os.Exit(1)
    }
}
```

\`\`\`

\#\# Configuration

The framework supports configuration via environment variables with sensible defaults:

\- \`ADDR\`: HTTP server address \(default: ":8080"\) \- \`METRICS\_ADDR\`: Metrics server address \(default: ":9090"\) \- \`METRICS\_PATH\`: Metrics endpoint path \(default: "/metrics"\) \- \`READ\_TIMEOUT\`: HTTP read timeout \(default: "10s"\) \- \`WRITE\_TIMEOUT\`: HTTP write timeout \(default: "10s"\) \- \`IDLE\_TIMEOUT\`: HTTP idle timeout \(default: "120s"\) \- \`SHUTDOWN\_TIMEOUT\`: Graceful shutdown timeout \(default: "30s"\)

\`\`\`go // Load configuration from environment config, err := service.LoadFromEnv\(\)

```
if err != nil {
    log.Fatal(err)
}
```

// Create service with custom configuration svc := service.New\("my\-service", config\) \`\`\`

\#\# Middleware

The framework includes several built\-in middleware:

\- \*\*LoggerMiddleware\*\*: Injects logger into request context \- \*\*RecoveryMiddleware\*\*: Recovers from panics and logs errors \- \*\*RequestLoggingMiddleware\*\*: Logs incoming requests \- \*\*MetricsMiddleware\*\*: Tracks HTTP metrics for Prometheus

\`\`\`go // Add custom middleware

```
svc.Use(func(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set("X-Custom", "value")
        next.ServeHTTP(w, r)
    })
})
```

\`\`\`

\#\# Metrics

The framework automatically collects Prometheus metrics:

\- \`\{service\_name\}\_http\_requests\_total\`: Total HTTP requests \- \`\{service\_name\}\_http\_request\_duration\_seconds\`: Request duration \- \`\{service\_name\}\_http\_requests\_in\_flight\`: In\-flight requests

Metrics are available at \`:9090/metrics\` by default.

\`\`\`go // Access metrics in handlers

```
func myHandler(w http.ResponseWriter, r *http.Request) {
    metrics := service.GetMetrics(r)
    if metrics != nil {
        // Custom metric operations can be added here
    }
}
```

\`\`\`

\#\# Graceful Shutdown

The framework supports graceful shutdown with signal handling and custom hooks:

\`\`\`go // Add shutdown hooks

```
svc.AddShutdownHook(func() error {
    // Cleanup resources
    return nil
})
```

// Start with graceful shutdown svc.StartWithGracefulShutdown\(\) \`\`\`

\#\# Logging

The framework uses structured logging with slog and provides context\-aware loggers:

\`\`\`go

```
func myHandler(w http.ResponseWriter, r *http.Request) {
    logger := service.GetLogger(r)
    logger.Info("request processed", "path", r.URL.Path)
}
```

\`\`\`

\#\# Health Checks

Health check endpoints are automatically available:

\- \`:9090/health\`: Basic health check \- \`:9090/metrics\`: Prometheus metrics

\#\# Kubernetes Deployment

The framework is designed for Kubernetes deployments with:

\- Graceful shutdown handling SIGTERM \- Health check endpoints for liveness/readiness probes \- Prometheus metrics for monitoring \- Configurable resource limits via environment variables

\#\# Examples

See the \`\_example/\` directory for complete working examples demonstrating:

\- Basic service setup \- Custom middleware \- Environment configuration \- Graceful shutdown \- Metrics integration

The framework is designed to be lightweight while providing all essential features for production\-ready microservices.

## Index

- [func GetLogger\(r \*http.Request\) \*slog.Logger](<#GetLogger>)
- [func IncCounter\(r \*http.Request, name string, labels ...string\)](<#IncCounter>)
- [func ObserveHistogram\(r \*http.Request, name string, value float64, labels ...string\)](<#ObserveHistogram>)
- [type Config](<#Config>)
  - [func DefaultConfig\(\) \*Config](<#DefaultConfig>)
  - [func LoadFromEnv\(\) \(\*Config, error\)](<#LoadFromEnv>)
  - [func \(c \*Config\) AddShutdownHook\(hook func\(\) error\)](<#Config.AddShutdownHook>)
- [type ContextKey](<#ContextKey>)
- [type MetricsCollector](<#MetricsCollector>)
  - [func GetMetrics\(r \*http.Request\) \*MetricsCollector](<#GetMetrics>)
  - [func NewMetricsCollector\(serviceName string\) \*MetricsCollector](<#NewMetricsCollector>)
- [type Middleware](<#Middleware>)
  - [func LoggerMiddleware\(logger \*slog.Logger\) Middleware](<#LoggerMiddleware>)
  - [func MetricsMiddleware\(metrics \*MetricsCollector\) Middleware](<#MetricsMiddleware>)
  - [func RecoveryMiddleware\(logger \*slog.Logger\) Middleware](<#RecoveryMiddleware>)
  - [func RequestLoggingMiddleware\(logger \*slog.Logger\) Middleware](<#RequestLoggingMiddleware>)
- [type Service](<#Service>)
  - [func New\(name string, config \*Config\) \*Service](<#New>)
  - [func \(s \*Service\) AddShutdownHook\(hook func\(\) error\)](<#Service.AddShutdownHook>)
  - [func \(s \*Service\) Handle\(pattern string, handler http.Handler\)](<#Service.Handle>)
  - [func \(s \*Service\) HandleFunc\(pattern string, handler http.HandlerFunc\)](<#Service.HandleFunc>)
  - [func \(s \*Service\) Start\(\) error](<#Service.Start>)
  - [func \(s \*Service\) StartWithGracefulShutdown\(\) error](<#Service.StartWithGracefulShutdown>)
  - [func \(s \*Service\) Stop\(\) error](<#Service.Stop>)
  - [func \(s \*Service\) Use\(middleware Middleware\)](<#Service.Use>)


<a name="GetLogger"></a>
## func [GetLogger](<https://github.com/atomicgo/service/blob/main/middleware.go#L39>)

```go
func GetLogger(r *http.Request) *slog.Logger
```

GetLogger retrieves the logger from the request context

<a name="IncCounter"></a>
## func [IncCounter](<https://github.com/atomicgo/service/blob/main/metrics.go#L115>)

```go
func IncCounter(r *http.Request, name string, labels ...string)
```

IncCounter increments a counter metric

<a name="ObserveHistogram"></a>
## func [ObserveHistogram](<https://github.com/atomicgo/service/blob/main/metrics.go#L132>)

```go
func ObserveHistogram(r *http.Request, name string, value float64, labels ...string)
```

ObserveHistogram observes a histogram metric

<a name="Config"></a>
## type [Config](<https://github.com/atomicgo/service/blob/main/config.go#L12-L31>)

Config holds all configuration for the service

```go
type Config struct {
    // HTTP Server configuration
    Addr         string        `env:"ADDR" envDefault:":8080"`
    ReadTimeout  time.Duration `env:"READ_TIMEOUT" envDefault:"10s"`
    WriteTimeout time.Duration `env:"WRITE_TIMEOUT" envDefault:"10s"`
    IdleTimeout  time.Duration `env:"IDLE_TIMEOUT" envDefault:"120s"`

    // Metrics server configuration
    MetricsAddr string `env:"METRICS_ADDR" envDefault:":9090"`
    MetricsPath string `env:"METRICS_PATH" envDefault:"/metrics"`

    // Graceful shutdown configuration
    ShutdownTimeout time.Duration `env:"SHUTDOWN_TIMEOUT" envDefault:"30s"`

    // Logger configuration
    Logger *slog.Logger `env:"-"`

    // Custom shutdown hooks
    ShutdownHooks []func() error `env:"-"`
}
```

<a name="DefaultConfig"></a>
### func [DefaultConfig](<https://github.com/atomicgo/service/blob/main/config.go#L34>)

```go
func DefaultConfig() *Config
```

DefaultConfig creates a new config with default values

<a name="LoadFromEnv"></a>
### func [LoadFromEnv](<https://github.com/atomicgo/service/blob/main/config.go#L49>)

```go
func LoadFromEnv() (*Config, error)
```

LoadFromEnv loads configuration from environment variables

<a name="Config.AddShutdownHook"></a>
### func \(\*Config\) [AddShutdownHook](<https://github.com/atomicgo/service/blob/main/config.go#L60>)

```go
func (c *Config) AddShutdownHook(hook func() error)
```

AddShutdownHook adds a function to be called during graceful shutdown

<a name="ContextKey"></a>
## type [ContextKey](<https://github.com/atomicgo/service/blob/main/middleware.go#L10>)

ContextKey is a custom type for context keys to avoid collisions

```go
type ContextKey string
```

<a name="LoggerKey"></a>

```go
const (
    // LoggerKey is the context key for the logger
    LoggerKey ContextKey = "logger"
    // MetricsKey is the context key for metrics
    MetricsKey ContextKey = "metrics"
)
```

<a name="MetricsCollector"></a>
## type [MetricsCollector](<https://github.com/atomicgo/service/blob/main/metrics.go#L14-L18>)

MetricsCollector holds all the metrics for the service

```go
type MetricsCollector struct {
    // contains filtered or unexported fields
}
```

<a name="GetMetrics"></a>
### func [GetMetrics](<https://github.com/atomicgo/service/blob/main/metrics.go#L106>)

```go
func GetMetrics(r *http.Request) *MetricsCollector
```

GetMetrics retrieves the metrics collector from the request context

<a name="NewMetricsCollector"></a>
### func [NewMetricsCollector](<https://github.com/atomicgo/service/blob/main/metrics.go#L21>)

```go
func NewMetricsCollector(serviceName string) *MetricsCollector
```

NewMetricsCollector creates a new metrics collector

<a name="Middleware"></a>
## type [Middleware](<https://github.com/atomicgo/service/blob/main/middleware.go#L20>)

Middleware represents a middleware function

```go
type Middleware func(http.Handler) http.Handler
```

<a name="LoggerMiddleware"></a>
### func [LoggerMiddleware](<https://github.com/atomicgo/service/blob/main/middleware.go#L23>)

```go
func LoggerMiddleware(logger *slog.Logger) Middleware
```

LoggerMiddleware injects the logger into the request context

<a name="MetricsMiddleware"></a>
### func [MetricsMiddleware](<https://github.com/atomicgo/service/blob/main/metrics.go#L67>)

```go
func MetricsMiddleware(metrics *MetricsCollector) Middleware
```

MetricsMiddleware creates middleware that records HTTP metrics

<a name="RecoveryMiddleware"></a>
### func [RecoveryMiddleware](<https://github.com/atomicgo/service/blob/main/middleware.go#L49>)

```go
func RecoveryMiddleware(logger *slog.Logger) Middleware
```

RecoveryMiddleware recovers from panics and logs them

<a name="RequestLoggingMiddleware"></a>
### func [RequestLoggingMiddleware](<https://github.com/atomicgo/service/blob/main/middleware.go#L65>)

```go
func RequestLoggingMiddleware(logger *slog.Logger) Middleware
```

RequestLoggingMiddleware logs incoming requests

<a name="Service"></a>
## type [Service](<https://github.com/atomicgo/service/blob/main/service.go#L9-L19>)

Service represents the main service instance

```go
type Service struct {
    Name    string
    Config  *Config
    Logger  *slog.Logger
    Metrics *MetricsCollector
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func [New](<https://github.com/atomicgo/service/blob/main/service.go#L22>)

```go
func New(name string, config *Config) *Service
```

New creates a new service instance

<a name="Service.AddShutdownHook"></a>
### func \(\*Service\) [AddShutdownHook](<https://github.com/atomicgo/service/blob/main/shutdown.go#L106>)

```go
func (s *Service) AddShutdownHook(hook func() error)
```

AddShutdownHook adds a function to be called during graceful shutdown

<a name="Service.Handle"></a>
### func \(\*Service\) [Handle](<https://github.com/atomicgo/service/blob/main/service.go#L57>)

```go
func (s *Service) Handle(pattern string, handler http.Handler)
```

Handle registers a handler for the given pattern

<a name="Service.HandleFunc"></a>
### func \(\*Service\) [HandleFunc](<https://github.com/atomicgo/service/blob/main/service.go#L50>)

```go
func (s *Service) HandleFunc(pattern string, handler http.HandlerFunc)
```

HandleFunc registers a handler function for the given pattern

<a name="Service.Start"></a>
### func \(\*Service\) [Start](<https://github.com/atomicgo/service/blob/main/service.go#L69>)

```go
func (s *Service) Start() error
```

Start starts the service and metrics server

<a name="Service.StartWithGracefulShutdown"></a>
### func \(\*Service\) [StartWithGracefulShutdown](<https://github.com/atomicgo/service/blob/main/shutdown.go#L12>)

```go
func (s *Service) StartWithGracefulShutdown() error
```

StartWithGracefulShutdown starts the service with graceful shutdown handling

<a name="Service.Stop"></a>
### func \(\*Service\) [Stop](<https://github.com/atomicgo/service/blob/main/shutdown.go#L111>)

```go
func (s *Service) Stop() error
```

Stop stops the service gracefully

<a name="Service.Use"></a>
### func \(\*Service\) [Use](<https://github.com/atomicgo/service/blob/main/service.go#L64>)

```go
func (s *Service) Use(middleware Middleware)
```

Use adds middleware to the service

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->

---

> [AtomicGo.dev](https://atomicgo.dev) &nbsp;&middot;&nbsp;
> with ❤️ by [@MarvinJWendt](https://github.com/MarvinJWendt) |
> [MarvinJWendt.com](https://marvinjwendt.com)
